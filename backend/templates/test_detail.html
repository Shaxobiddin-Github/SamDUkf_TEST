{% extends 'base.html' %}
{% block title %}{{ test.title }}{% endblock %}
{% block content %}
    <h2>{{ test.title }} - {{ test.subject }}</h2>
    {% if error %}
        <p style="color: red;">{{ error }}</p>
    {% elif student_test %}
        <p>Qolgan vaqt: <span id="timer"></span></p>
        <form method="post" action="{% url 'submit_answer' test.id %}">
            {% csrf_token %}
            {% for question in questions %}
                <p>{{ question.text }}</p>
                <label><input type="radio" name="selected_option_{{ question.id }}" value="A"> {{ question.option_a }}</label><br>
                <label><input type="radio" name="selected_option_{{ question.id }}" value="B"> {{ question.option_b }}</label><br>
                <label><input type="radio" name="selected_option_{{ question.id }}" value="C"> {{ question.option_c }}</label><br>
                <label><input type="radio" name="selected_option_{{ question.id }}" value="D"> {{ question.option_d }}</label><br>
                <input type="hidden" name="question_id" value="{{ question.id }}">
            {% endfor %}
            <button type="submit" name="submit">Javob yuborish</button>
            <button type="submit" name="finish">Testni yakunlash</button>
        </form>
        <script>
            const endTime = new Date('{{ student_test.end_time|date:"c" }}').getTime();
            function updateTimer() {
                const now = new Date().getTime();
                const timeLeft = endTime - now;
                if (timeLeft <= 0) {
                    document.getElementById('timer').innerText = 'Vaqt tugadi!';
                    document.forms[0].submit();
                } else {
                    const minutes = Math.floor(timeLeft / 1000 / 60);
                    const seconds = Math.floor((timeLeft / 1000) % 60);
                    document.getElementById('timer').innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                }
            }
            setInterval(updateTimer, 1000);
        </script>
    {% endif %}
{% endblock %}